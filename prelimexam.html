<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>IT 221 Prelim Exam (Web App)</title>
  <style>
    :root{
      --bg:#0b1020; --card:#121a33; --text:#e9ecff; --muted:#aeb7df;
      --accent:#7aa2ff; --danger:#ff6b6b; --ok:#4ade80; --border:#253057;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background: radial-gradient(1200px 600px at 20% 0%, #18224a 0%, var(--bg) 55%);
      color:var(--text);
    }
    .wrap{max-width:920px; margin:0 auto; padding:24px}
    .header{
      display:flex; gap:16px; align-items:flex-start; justify-content:space-between; flex-wrap:wrap;
      margin-bottom:16px;
    }
    .title h1{margin:0 0 6px 0; font-size:20px; letter-spacing:.2px}
    .title p{margin:0; color:var(--muted); font-size:13px; line-height:1.4}
    .pillrow{display:flex; gap:8px; flex-wrap:wrap; align-items:center}
    .pill{
      background:rgba(255,255,255,.06); border:1px solid var(--border);
      padding:8px 10px; border-radius:999px; font-size:12px; color:var(--muted);
    }
    .pill strong{color:var(--text)}
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--border); border-radius:16px;
      padding:18px; box-shadow: 0 10px 30px rgba(0,0,0,.25);
    }
    .row{display:flex; gap:14px; flex-wrap:wrap}
    .grow{flex:1 1 520px}
    .side{flex:1 1 250px}
    .btnrow{display:flex; gap:10px; flex-wrap:wrap; margin-top:14px}
    button{
      background:rgba(122,162,255,.16);
      color:var(--text);
      border:1px solid rgba(122,162,255,.45);
      padding:10px 12px; border-radius:12px;
      cursor:pointer; font-weight:600;
    }
    button:hover{filter:brightness(1.08)}
    button:disabled{opacity:.5; cursor:not-allowed}
    .danger{background:rgba(255,107,107,.14); border-color:rgba(255,107,107,.55)}
    .ok{background:rgba(74,222,128,.14); border-color:rgba(74,222,128,.55)}
    .questionNo{color:var(--muted); font-size:12px; margin-bottom:8px}
    .qtext{font-size:16px; line-height:1.35; margin:0 0 14px 0}
    .opts{display:flex; flex-direction:column; gap:10px}
    .opt{
      display:flex; gap:10px; align-items:flex-start;
      padding:10px 12px; border-radius:14px;
      border:1px solid var(--border);
      background:rgba(0,0,0,.12);
    }
    .opt:hover{border-color:rgba(122,162,255,.55)}
    .opt input{margin-top:3px}
    .key{display:inline-flex; align-items:center; justify-content:center;
      width:26px; height:26px; border-radius:9px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.06);
      font-weight:800; color:var(--text); flex:0 0 auto;
      font-size:12px;
    }
    .opt label{cursor:pointer; display:block; width:100%}
    select{
      width:100%;
      background:rgba(0,0,0,.18);
      color:var(--text);
      border:1px solid var(--border);
      border-radius:12px;
      padding:10px 12px;
      outline:none;
      font-size:14px;
    }
    .timerbox{
      padding:12px; border-radius:14px; border:1px solid var(--border);
      background:rgba(0,0,0,.12);
    }
    .timerbig{font-size:34px; font-weight:900; letter-spacing:.5px}
    .muted{color:var(--muted)}
    .bar{height:10px; border-radius:999px; overflow:hidden; background:rgba(255,255,255,.06); border:1px solid var(--border); margin-top:10px}
    .fill{height:100%; width:100%; background:linear-gradient(90deg, var(--accent), #9d7aff)}
    .small{font-size:12px}
    .results h2{margin:0 0 8px 0}
    .grid{
      display:grid; grid-template-columns:1fr; gap:10px; margin-top:14px
    }
    .resItem{
      padding:12px; border-radius:14px; border:1px solid var(--border);
      background:rgba(0,0,0,.10)
    }
    .resTop{
      display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap;
      margin-bottom:8px;
    }
    .badge{
      display:inline-flex; align-items:center; gap:8px;
      padding:6px 10px; border-radius:999px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.06);
      font-size:12px; color:var(--muted);
    }
    .badge b{color:var(--text)}
    .correct{border-color:rgba(74,222,128,.55)}
    .wrong{border-color:rgba(255,107,107,.55)}
    .unanswered{border-color:rgba(174,183,223,.35)}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div class="title">
        <h1>IT 221 — Information Assurance and Security I (Prelim Exam)</h1>
        <p>Timed web exam: <strong>20 seconds per item</strong>, auto-next, randomized order, score revealed at the end.</p>
      </div>
      <div class="pillrow">
        <div class="pill">Items: <strong id="pillTotal">—</strong></div>
        <div class="pill">Per item: <strong>20s</strong></div>
        <div class="pill">Mode: <strong>Auto-advance</strong></div>
      </div>
    </div>

    <div id="screenStart" class="card">
      <p class="muted" style="margin-top:0">
        Instructions: Click <b>Start Exam</b>. Each question lasts 20 seconds. You may answer anytime within the timer;
        when time runs out, the exam automatically proceeds to the next item.
      </p>
      <div class="btnrow">
        <button id="btnStart" class="ok">Start Exam</button>
        <button id="btnShuffle" title="Reshuffle questions order">Reshuffle Order</button>
        <button id="btnReset" class="danger" title="Reset answers and reshuffle">Reset</button>
      </div>
      <p class="muted small" style="margin-bottom:0">
        Tip: Open this file in fullscreen for an “exam room” feel.
      </p>
    </div>

    <div id="screenExam" class="row" style="display:none; margin-top:16px">
      <div class="card grow">
        <div class="questionNo">
          Question <span id="qIndex">1</span> of <span id="qTotal">—</span>
          <span class="muted">• Original No. <span id="qOriginal">—</span></span>
          <span class="muted">• Points: <span id="qPoints">—</span></span>
        </div>
        <p id="qText" class="qtext"></p>

        <div id="qOptions"></div>

        <div class="btnrow">
          <button id="btnNext">Next</button>
          <button id="btnEndEarly" class="danger">End Exam</button>
        </div>

        <p class="muted small" style="margin:10px 0 0 0">
          Note: No backtracking (to simulate a timed exam flow).
        </p>
      </div>

      <div class="card side">
        <div class="timerbox">
          <div class="muted small">Time remaining</div>
          <div class="timerbig mono"><span id="timeLeft">20</span>s</div>
          <div class="bar"><div id="timeFill" class="fill"></div></div>
          <div class="muted small" style="margin-top:10px">
            Answer saved automatically when selected.
          </div>
        </div>

        <div style="margin-top:14px" class="timerbox">
          <div class="muted small">Progress</div>
          <div class="mono" style="font-weight:900; font-size:18px">
            <span id="answeredCount">0</span>/<span id="progressTotal">—</span>
          </div>
          <div class="muted small">answered</div>
        </div>
      </div>
    </div>

    <div id="screenResults" class="card results" style="display:none; margin-top:16px">
      <h2>Results</h2>
      <div class="pillrow" style="margin-bottom:6px">
        <div class="badge">Score: <b id="scoreText">—</b></div>
        <div class="badge">Correct: <b id="correctCount">—</b></div>
        <div class="badge">Wrong: <b id="wrongCount">—</b></div>
        <div class="badge">Unanswered: <b id="unansweredCount">—</b></div>
      </div>
      <p class="muted" style="margin-top:0">
        Review below shows your answer and the correct answer key (letter-based).
      </p>

      <div class="btnrow" style="margin-top:0">
        <button id="btnRestart" class="ok">Restart (New Random Order)</button>
        <button id="btnBackHome">Back to Start</button>
      </div>

      <div id="resultsGrid" class="grid"></div>
    </div>
  </div>

<script>
(function(){
  const PER_ITEM_SECONDS = 20;

  // -------------------------------
  // Question Bank (with points)
  // -------------------------------
  const matchingOptions = [
    { key:"A", label:"Administrative control" },
    { key:"B", label:"Technical control" },
    { key:"C", label:"Physical control" },
    { key:"D", label:"Security tradeoffs" },
    { key:"E", label:"Security culture" },
    { key:"F", label:"Baseline Workstation Security Audit" },
    { key:"G", label:"Snapshot" },
    { key:"H", label:"Security landscape" },
    { key:"I", label:"Security Analyst" },
    { key:"J", label:"Security Engineer" },
    { key:"K", label:"Incident Responder" },
    { key:"L", label:"Chief Information Security Officer (CISO)" },
    { key:"M", label:"Security Systems Development Life Cycle (SecSDLC)" },
    { key:"N", label:"Vector" },
    { key:"O", label:"Payload" },
    { key:"P", label:"Virus" },
    { key:"Q", label:"Worm" },
    { key:"R", label:"Trojan" },
    { key:"S", label:"Ransomware" },
    { key:"T", label:"Polymorphism" },
  ];

  const options14_20 = [
    { key:"A", label:"Correct permissions (roles, least privilege)" },
    { key:"B", label:"Actions traceable to individuals (audit trails)" },
    { key:"C", label:"Likelihood × impact" },
    { key:"D", label:"Prove identity (passwords, biometrics, MFA)" },
    { key:"E", label:"Actions can’t be denied later (digital signatures, logs)" },
    { key:"F", label:"Something that can cause harm (actor/event)" },
    { key:"G", label:"Weakness that can be exploited" },
  ];

  // Test 1: Q1–Q20 => 1 point each
  // Test 2: Q21–Q40 => 2 points each
  const questionBank = [
    // 1-13 Multiple Choice (1 pt)
    { original:1, points:1, type:"mc", text:"Which of the following are examples of information assets?",
      options:[
        {key:"A", label:"Student data, records, finances, intellectual property"},
        {key:"B", label:"Campus buildings, classrooms, laboratory equipment, and furniture used for instruction"},
        {key:"C", label:"Network routers, switches, access points, and physical cables used for connectivity"},
        {key:"D", label:"Sports uniforms, cafeteria supplies, printed materials, and other consumable campus resources"},
      ],
      answer:"A"
    },
    { original:2, points:1, type:"mc", text:"Which of the following are consequences of security incidents?",
      options:[
        {key:"A", label:"Encryption, access control, MFA, and change control used to reduce unauthorized actions"},
        {key:"B", label:"Backups, redundancy, fault tolerance, and restore drills used to support resilience planning"},
        {key:"C", label:"Money loss, downtime, reputation damage, penalties"},
        {key:"D", label:"Threat actors, vulnerabilities, misconfigurations, and unpatched systems that increase exposure"},
      ],
      answer:"C"
    },
    { original:3, points:1, type:"mc", text:"The socio-technical reality means:",
      options:[
        {key:"A", label:"Security = technology + tools + infrastructure"},
        {key:"B", label:"Security = people + process + technology"},
        {key:"C", label:"Security = policies + compliance + documentation"},
        {key:"D", label:"Security = encryption + firewalls + antivirus"},
      ],
      answer:"B"
    },
    { original:4, points:1, type:"mc", text:"Continuity means:",
      options:[
        {key:"A", label:"Systems must prevent unauthorized access through encryption and access control measures"},
        {key:"B", label:"Systems must ensure accurate, unmodified information through hashing and change control"},
        {key:"C", label:"Systems must remain accessible when needed through redundancy and fault tolerance planning"},
        {key:"D", label:"Systems must recover quickly after incidents"},
      ],
      answer:"C"
    },
    { original:5, points:1, type:"mc", text:"Information Assurance (IA) ensures information remains:",
      options:[
        {key:"A", label:"Protects information from unauthorized access or alteration (focus on protecting data)"},
        {key:"B", label:"Protects digital systems and networks from cyber attacks (focus on systems & networks)"},
        {key:"C", label:"Trustworthy, resilient, and well-governed"},
        {key:"D", label:"Accessible when needed through backups, redundancy, and fault tolerance planning"},
      ],
      answer:"C"
    },
    { original:6, points:1, type:"mc", text:"Information Security (InfoSec) protects information from:",
      options:[
        {key:"A", label:"Money loss, downtime, reputation damage, penalties that may result from security incidents"},
        {key:"B", label:"Likelihood × impact used to measure risk and guide security requirements during analysis"},
        {key:"C", label:"Digital systems and networks from cyber attacks (focus on systems & networks)"},
        {key:"D", label:"Unauthorized access or alteration (focus on protecting data)"},
      ],
      answer:"D"
    },
    { original:7, points:1, type:"mc", text:"Cybersecurity protects:",
      options:[
        {key:"A", label:"Digital systems and networks from cyber attacks (focus on systems & networks)"},
        {key:"B", label:"Information from unauthorized access or alteration (focus on protecting data)"},
        {key:"C", label:"Information remains trustworthy, resilient, and well-governed through governance and continuity"},
        {key:"D", label:"Facilities and hardware through locks, secure rooms, guards, and access restrictions"},
      ],
      answer:"A"
    },
    { original:8, points:1, type:"mc", text:"Confidentiality means:",
      options:[
        {key:"A", label:"Likelihood × impact"},
        {key:"B", label:"Accessible when needed (backups, redundancy, fault tolerance)"},
        {key:"C", label:"Accurate, unmodified information (hashing, checksums, change control)"},
        {key:"D", label:"Only authorized access (encryption, access control, MFA)"},
      ],
      answer:"D"
    },
    { original:9, points:1, type:"mc", text:"Confidentiality controls include:",
      options:[
        {key:"A", label:"Hashing, checksums, change control"},
        {key:"B", label:"Encryption, access control, MFA"},
        {key:"C", label:"Backups, redundancy, fault tolerance"},
        {key:"D", label:"Digital signatures, logs, audit trails"},
      ],
      answer:"B"
    },
    { original:10, points:1, type:"mc", text:"Integrity means:",
      options:[
        {key:"A", label:"Accurate, unmodified information (hashing, checksums, change control)"},
        {key:"B", label:"Only authorized access (encryption, access control, MFA)"},
        {key:"C", label:"Accessible when needed (backups, redundancy, fault tolerance)"},
        {key:"D", label:"Actions can’t be denied later (digital signatures, logs)"},
      ],
      answer:"A"
    },
    { original:11, points:1, type:"mc", text:"Integrity controls include:",
      options:[
        {key:"A", label:"Encryption, access control, MFA"},
        {key:"B", label:"Backups, redundancy, fault tolerance"},
        {key:"C", label:"Hashing, checksums, change control"},
        {key:"D", label:"Digital signatures, logs, audit trails"},
      ],
      answer:"C"
    },
    { original:12, points:1, type:"mc", text:"Availability means:",
      options:[
        {key:"A", label:"Accurate, unmodified information (hashing, checksums, change control)"},
        {key:"B", label:"Only authorized access (encryption, access control, MFA)"},
        {key:"C", label:"Accessible when needed (backups, redundancy, fault tolerance)"},
        {key:"D", label:"Actions traceable to individuals (audit trails)"},
      ],
      answer:"C"
    },
    { original:13, points:1, type:"mc", text:"Availability controls include:",
      options:[
        {key:"A", label:"Hashing, checksums, change control"},
        {key:"B", label:"Backups, redundancy, fault tolerance"},
        {key:"C", label:"Encryption, access control, MFA"},
        {key:"D", label:"Digital signatures, logs, audit trails"},
      ],
      answer:"B"
    },

    // 14-20 (1 pt)
    { original:14, points:1, type:"mc", text:"Authentication means:", options: options14_20, answer:"D" },
    { original:15, points:1, type:"mc", text:"Authorization means:", options: options14_20, answer:"A" },
    { original:16, points:1, type:"mc", text:"Non-repudiation means:", options: options14_20, answer:"E" },
    { original:17, points:1, type:"mc", text:"Accountability means:", options: options14_20, answer:"B" },
    { original:18, points:1, type:"mc", text:"Threat means:", options: options14_20, answer:"F" },
    { original:19, points:1, type:"mc", text:"Vulnerability means:", options: options14_20, answer:"G" },
    { original:20, points:1, type:"mc", text:"Risk means:", options: options14_20, answer:"C" },

    // 21-40 matching (2 pts)  <-- TEST 2
    { original:21, points:2, type:"match", text:"Which type of security control includes policies, training, procedures, and risk management?",
      options: matchingOptions, answer:"A"
    },
    { original:22, points:2, type:"match", text:"Which type of control includes firewalls, MFA, encryption, antivirus, and IDS/IPS?",
      options: matchingOptions, answer:"B"
    },
    { original:23, points:2, type:"match", text:"Which type of control includes locks, CCTV, guards, and secure rooms?",
      options: matchingOptions, answer:"C"
    },
    { original:24, points:2, type:"match", text:"What do we call the need to balance security with usability, cost, and performance to reduce risk to an acceptable level?",
      options: matchingOptions, answer:"D"
    },
    { original:25, points:2, type:"match", text:"What do we call habits like verifying URLs, locking screens, avoiding unknown USBs, and reporting suspicious activity early?",
      options: matchingOptions, answer:"E"
    },
    { original:26, points:2, type:"match", text:"In the lab, what do we call a checklist-based workstation review (accounts, updates, protections, backups) documented with evidence and recommendations?",
      options: matchingOptions, answer:"F"
    },
    { original:27, points:2, type:"match", text:"In a VM sandbox, what do we call the snapshot that acts like a reset button?",
      options: matchingOptions, answer:"G"
    },
    { original:28, points:2, type:"match", text:"What term refers to the overall environment of threats, defenses, technologies, and professionals that keeps evolving?",
      options: matchingOptions, answer:"H"
    },
    { original:29, points:2, type:"match", text:"Which security role monitors systems and analyzes security logs to respond to security events?",
      options: matchingOptions, answer:"I"
    },
    { original:30, points:2, type:"match", text:"Which security role designs and implements security solutions?",
      options: matchingOptions, answer:"J"
    },
    { original:31, points:2, type:"match", text:"Which security role handles breaches and cyber incidents (detection, response, and recovery)?",
      options: matchingOptions, answer:"K"
    },
    { original:32, points:2, type:"match", text:"Which executive role leads an organization’s security strategy?",
      options: matchingOptions, answer:"L"
    },
    { original:33, points:2, type:"match", text:"What is the structured process that integrates security into system development from the beginning (not added later)?",
      options: matchingOptions, answer:"M"
    },
    { original:34, points:2, type:"match", text:"In malware analysis, what is the term for “how it gets in” (email attachment, malicious link, USB, drive-by download, exploit)?",
      options: matchingOptions, answer:"N"
    },
    { original:35, points:2, type:"match", text:"In malware analysis, what is the term for “what it does” (encrypt, steal, delete, spy, open backdoor, recruit into a botnet)?",
      options: matchingOptions, answer:"O"
    },
    { original:36, points:2, type:"match", text:"What type of malware attaches to a host file and often needs user action (run/open) to spread?",
      options: matchingOptions, answer:"P"
    },
    { original:37, points:2, type:"match", text:"What type of malware self-replicates without user help and can spread through networks or vulnerabilities?",
      options: matchingOptions, answer:"Q"
    },
    { original:38, points:2, type:"match", text:"What type of malware looks legitimate (installer/crack/fake update) but performs hidden actions like credential theft?",
      options: matchingOptions, answer:"R"
    },
    { original:39, points:2, type:"match", text:"What malware type encrypts files and demands payment—often causing downtime and panic?",
      options: matchingOptions, answer:"S"
    },
    { original:40, points:2, type:"match", text:"What evasion technique changes malware code appearance so signatures fail, but intent/behavior stays the same?",
      options: matchingOptions, answer:"T"
    },
  ];

  // -------------------------------
  // State
  // -------------------------------
  let questions = [];
  let currentIndex = 0;
  let timerId = null;
  let secondsLeft = PER_ITEM_SECONDS;
  let answers = new Map(); // key: original number, value: selected letter or ""/null

  // -------------------------------
  // Elements
  // -------------------------------
  const el = (id)=>document.getElementById(id);
  const screenStart = el("screenStart");
  const screenExam = el("screenExam");
  const screenResults = el("screenResults");

  const pillTotal = el("pillTotal");
  const qIndex = el("qIndex");
  const qTotal = el("qTotal");
  const qOriginal = el("qOriginal");
  const qPoints = el("qPoints");
  const qText = el("qText");
  const qOptions = el("qOptions");

  const timeLeft = el("timeLeft");
  const timeFill = el("timeFill");
  const answeredCount = el("answeredCount");
  const progressTotal = el("progressTotal");

  const btnStart = el("btnStart");
  const btnShuffle = el("btnShuffle");
  const btnReset = el("btnReset");
  const btnNext = el("btnNext");
  const btnEndEarly = el("btnEndEarly");

  const scoreText = el("scoreText");
  const correctCount = el("correctCount");
  const wrongCount = el("wrongCount");
  const unansweredCount = el("unansweredCount");
  const resultsGrid = el("resultsGrid");
  const btnRestart = el("btnRestart");
  const btnBackHome = el("btnBackHome");

  // -------------------------------
  // Helpers
  // -------------------------------
  function shuffle(arr){
    const a = arr.slice();
    for(let i=a.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [a[i],a[j]] = [a[j],a[i]];
    }
    return a;
  }

  function resetTimer(){
    secondsLeft = PER_ITEM_SECONDS;
    timeLeft.textContent = String(secondsLeft);
    timeFill.style.width = "100%";
  }

  function stopTimer(){
    if(timerId){ clearInterval(timerId); timerId = null; }
  }

  function startTimer(){
    stopTimer();
    timerId = setInterval(()=>{
      secondsLeft -= 1;
      if(secondsLeft < 0) secondsLeft = 0;
      timeLeft.textContent = String(secondsLeft);

      const pct = (secondsLeft / PER_ITEM_SECONDS) * 100;
      timeFill.style.width = pct + "%";
      if(secondsLeft <= 5){
        timeFill.style.filter = "brightness(1.1)";
      } else {
        timeFill.style.filter = "none";
      }

      if(secondsLeft === 0){
        stopTimer();
        goNext(true);
      }
    }, 1000);
  }

  function updateProgress(){
    const total = questions.length;
    progressTotal.textContent = String(total);
    qTotal.textContent = String(total);
    pillTotal.textContent = String(total);

    let answered = 0;
    for(const q of questions){
      const v = answers.get(q.original);
      if(v && v.trim() !== "") answered++;
    }
    answeredCount.textContent = String(answered);
  }

  function renderQuestion(){
    const q = questions[currentIndex];
    qIndex.textContent = String(currentIndex + 1);
    qOriginal.textContent = String(q.original);
    qPoints.textContent = String(q.points ?? 1);
    qText.textContent = q.text;

    qOptions.innerHTML = "";

    const saved = answers.get(q.original) || "";

    if(q.type === "match"){
      const wrap = document.createElement("div");
      wrap.className = "opts";
      const sel = document.createElement("select");
      sel.setAttribute("aria-label", "Select your answer");
      const placeholder = document.createElement("option");
      placeholder.value = "";
      placeholder.textContent = "— Select an option —";
      sel.appendChild(placeholder);
      for(const opt of q.options){
        const o = document.createElement("option");
        o.value = opt.key;
        o.textContent = `${opt.key}. ${opt.label}`;
        if(saved === opt.key) o.selected = true;
        sel.appendChild(o);
      }
      sel.addEventListener("change", ()=>{
        answers.set(q.original, sel.value);
        updateProgress();
      });
      wrap.appendChild(sel);
      qOptions.appendChild(wrap);
    } else {
      const optsWrap = document.createElement("div");
      optsWrap.className = "opts";

      for(const opt of q.options){
        const id = `q${q.original}_${opt.key}`;
        const row = document.createElement("div");
        row.className = "opt";

        const radio = document.createElement("input");
        radio.type = "radio";
        radio.name = `q_${q.original}`;
        radio.id = id;
        radio.value = opt.key;
        radio.checked = (saved === opt.key);

        radio.addEventListener("change", ()=>{
          answers.set(q.original, opt.key);
          updateProgress();
        });

        const k = document.createElement("div");
        k.className = "key";
        k.textContent = opt.key;

        const label = document.createElement("label");
        label.htmlFor = id;
        label.textContent = opt.label;

        row.appendChild(radio);
        row.appendChild(k);
        row.appendChild(label);
        optsWrap.appendChild(row);
      }
      qOptions.appendChild(optsWrap);
    }

    updateProgress();
    resetTimer();
    startTimer();
  }

  function showStart(){
    stopTimer();
    screenStart.style.display = "";
    screenExam.style.display = "none";
    screenResults.style.display = "none";
  }

  function showExam(){
    screenStart.style.display = "none";
    screenExam.style.display = "";
    screenResults.style.display = "none";
    renderQuestion();
  }

  function showResults(){
    stopTimer();
    screenStart.style.display = "none";
    screenExam.style.display = "none";
    screenResults.style.display = "";

    let totalPoints = 0;
    let earnedPoints = 0;
    let correct = 0, wrong = 0, unans = 0;

    resultsGrid.innerHTML = "";

    for(const q of questions){
      const your = (answers.get(q.original) || "").trim();
      const ok = q.answer;
      const pts = q.points ?? 1;

      totalPoints += pts;

      const isAnswered = your !== "";
      const isCorrect = isAnswered && your === ok;

      if(!isAnswered) unans++;
      else if(isCorrect) { correct++; earnedPoints += pts; }
      else wrong++;

      const card = document.createElement("div");
      card.className = "resItem " + (isCorrect ? "correct" : (isAnswered ? "wrong" : "unanswered"));

      const top = document.createElement("div");
      top.className = "resTop";

      const left = document.createElement("div");
      left.innerHTML = `<div class="muted small">Original No. <b>${q.original}</b> • Points: <b>${pts}</b></div>
                        <div style="font-weight:800; margin-top:2px">${escapeHtml(q.text)}</div>`;

      const right = document.createElement("div");
      right.style.display = "flex";
      right.style.gap = "8px";
      right.style.flexWrap = "wrap";

      const b1 = document.createElement("div");
      b1.className = "badge";
      b1.innerHTML = `Your: <b class="mono">${your || "—"}</b>`;

      const b2 = document.createElement("div");
      b2.className = "badge";
      b2.innerHTML = `Correct: <b class="mono">${ok}</b>`;

      right.appendChild(b1);
      right.appendChild(b2);

      top.appendChild(left);
      top.appendChild(right);

      card.appendChild(top);

      const keyLine = document.createElement("div");
      keyLine.className = "muted small";
      keyLine.textContent = describeOption(q, ok, your);
      card.appendChild(keyLine);

      resultsGrid.appendChild(card);
    }

    const scorePct = Math.round((earnedPoints / totalPoints) * 100);
    scoreText.textContent = `${earnedPoints}/${totalPoints} (${scorePct}%)`;
    correctCount.textContent = String(correct);
    wrongCount.textContent = String(wrong);
    unansweredCount.textContent = String(unans);
  }

  function escapeHtml(s){
    return String(s)
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  function optionLabel(q, key){
    const opt = q.options.find(o=>o.key===key);
    if(!opt) return "";
    return `${key}. ${opt.label}`;
  }

  function describeOption(q, ok, your){
    const okLabel = optionLabel(q, ok);
    const yourLabel = your ? optionLabel(q, your) : "";
    if(!your) return `Unanswered. Correct is: ${okLabel}`;
    if(your === ok) return `Correct: ${okLabel}`;
    return `You chose: ${yourLabel} • Correct is: ${okLabel}`;
  }

  function initQuestions(){
    questions = shuffle(questionBank);
    currentIndex = 0;
    answers = new Map();
    updateProgress();
  }

  function goNext(fromAuto=false){
    if(currentIndex < questions.length - 1){
      currentIndex++;
      renderQuestion();
    } else {
      showResults();
    }
  }

  function resetAll(){
    initQuestions();
    showStart();
  }

  // -------------------------------
  // Wire up buttons
  // -------------------------------
  btnStart.addEventListener("click", ()=>{
    showExam();
  });

  btnShuffle.addEventListener("click", ()=>{
    questions = shuffle(questionBank);
    currentIndex = 0;
    answers = new Map();
    updateProgress();
    alert("Question order reshuffled. Click Start Exam when ready.");
  });

  btnReset.addEventListener("click", ()=>{
    resetAll();
    alert("Reset done. Ready for a new randomized exam.");
  });

  btnNext.addEventListener("click", ()=>{
    stopTimer();
    goNext(false);
  });

  btnEndEarly.addEventListener("click", ()=>{
    showResults();
  });

  btnRestart.addEventListener("click", ()=>{
    initQuestions();
    showExam();
  });

  btnBackHome.addEventListener("click", ()=>{
    showStart();
  });

  // -------------------------------
  // Start state
  // -------------------------------
  initQuestions();
  showStart();
})();
</script>
</body>
</html>
